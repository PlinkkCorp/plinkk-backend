<header class="sticky top-0 z-50 border-b border-fuchsia-600/30 bg-gradient-to-r from-slate-950/80 via-fuchsia-900/35 to-slate-950/80 backdrop-blur" style="position: sticky">
    <style>
        #spaTopLoaderDash { position: fixed; top: 0; left: 0; width: 100%; height: 3px; z-index: 10000; pointer-events: none; opacity: 0; transition: opacity .15s ease; }
        #spaTopLoaderDash.active { opacity: 1; }
        #spaTopLoaderDash .prog { width: 0%; height: 100%;
            background: linear-gradient(90deg, #ec4899, #f472b6);
            box-shadow: 0 0 8px rgba(236, 72, 153, .6);
            transition: width .18s ease; }
    </style>
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
        <a href="/" class="flex items-center gap-2">
            <img src="/public/images/logo.svg" alt="Plinkk" class="h-8 w-8 rounded" />
            <span class="hidden sm:inline text-sm font-semibold tracking-wide text-slate-200">Plinkk</span>
        </a>
        <div class="flex-1 min-w-0"></div>
        <% const __SMS__ = (typeof __SITE_MESSAGES__ !== 'undefined' && Array.isArray(__SITE_MESSAGES__)) ? __SITE_MESSAGES__ : ((typeof __SITE_MESSAGE__ !== 'undefined' && __SITE_MESSAGE__ && __SITE_MESSAGE__.message) ? [__SITE_MESSAGE__.message] : []); %>
        <% if (__SMS__.length) { %>
            <% __SMS__.slice(0,3).forEach(function(__SM__, idx){ %>
            <% const lvl = (__SM__.level || 'info').toLowerCase();
                             let bg='bg-slate-700/20', br='border-slate-600/40', tx='text-slate-100', btn='bg-slate-600/80 hover:bg-slate-600', icon='info';
                             if (lvl==='info') { bg='bg-sky-700/20'; br='border-sky-600/40'; tx='text-sky-50'; btn='bg-sky-600/80 hover:bg-sky-600'; icon='info'; }
                             else if (lvl==='success') { bg='bg-emerald-700/20'; br='border-emerald-600/40'; tx='text-emerald-50'; btn='bg-emerald-600/80 hover:bg-emerald-600'; icon='check'; }
                             else if (lvl==='warning') { bg='bg-amber-700/20'; br='border-amber-600/40'; tx='text-amber-50'; btn='bg-amber-600/80 hover:bg-amber-600'; icon='warn'; }
                             else if (lvl==='error' || lvl==='critical') { bg='bg-rose-700/20'; br='border-rose-600/40'; tx='text-rose-50'; btn='bg-rose-600/80 hover:bg-rose-600'; icon='error'; }
                             else if (lvl==='maintenance') { bg='bg-indigo-700/20'; br='border-indigo-600/40'; tx='text-indigo-50'; btn='bg-indigo-600/80 hover:bg-indigo-600'; icon='wrench'; }
                        %>
            <div class="ml-4 hidden sm:block" id="siteMessageWrapDash_<%- idx %>" data-msg='<%- JSON.stringify(__SM__ || null).replace(/'/g, "&#39;") %>'>
                <div class="<%= `mt-1 px-3 py-1 text-xs rounded-md border ${br} ${bg} ${tx} flex items-center gap-2` %>" role="status" aria-live="polite" style="align-items:center">
                                        <span aria-hidden="true">
                                            <% if (icon==='info') { %>
                                                <svg class="w-4 h-4 align-middle" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16Zm-.75-9.25a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5ZM10 6a1 1 0 100 2 1 1 0 000-2Z" clip-rule="evenodd"/></svg>
                                            <% } else if (icon==='check') { %>
                                                <svg class="w-4 h-4 align-middle" viewBox="0 0 24 24" fill="currentColor"><path d="M9 12.75l-2.25-2.25-1.5 1.5L9 15.75l9-9-1.5-1.5z"/></svg>
                                            <% } else if (icon==='warn') { %>
                                                <svg class="w-4 h-4 align-middle" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v2h2v-2zm0-8h-2v6h2V10z"/></svg>
                                            <% } else if (icon==='error') { %>
                                                <svg class="w-4 h-4 align-middle" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 110 20 10 10 0 010-20zm-1 5h2v7h-2V7zm0 9h2v2h-2v-2z"/></svg>
                                            <% } else if (icon==='wrench') { %>
                                                <svg class="w-4 h-4 align-middle" viewBox="0 0 24 24" fill="currentColor"><path d="M22.7 19.3l-6.5-6.5a6 6 0 11-3.2-3.2l6.5 6.5a2.25 2.25 0 103.2 3.2zM10 14a4 4 0 100-8 4 4 0 000 8z"/></svg>
                                            <% } %>
                                        </span>
                                        <span class="ml-1 flex-1"><%= __SM__.text %></span>
                                        <% if (__SM__.dismissible) { %>
                                            <button id="dismissSiteMessageDash_<%- idx %>" aria-label="Fermer l'alerte" class="inline-flex items-center justify-center rounded hover:opacity-90 transition focus:outline-none focus:ring-1 focus:ring-white/40" style="width:22px;height:22px">
                                                <svg class="w-3.5 h-3.5 align-middle" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7A1 1 0 0 0 5.7 7.11L10.59 12 5.7 16.89a1 1 0 1 0 1.41 1.41L12 13.41l4.89 4.89a1 1 0 0 0 1.41-1.41L13.41 12l4.89-4.89a1 1 0 0 0 0-1.4z"/></svg>
                                            </button>
                                        <% } %>
                                </div>
                        </div>
                        <% }) %>
                <% } %>
        <div class="flex-1 min-w-0"></div>
        <div class="hidden md:flex items-center gap-3">
            <a href="https://github.com/PlinkkCorp/plinkk-backend" target="_blank" class="px-3 py-1.5 text-xs rounded-md border border-slate-700/60 bg-slate-800/50 hover:bg-slate-700/60">GitHub</a>
            <a href="<%= frontendUrl %>/users" class="px-3 py-1.5 text-xs rounded-md border border-slate-700/60 bg-slate-800/50 hover:bg-slate-700/60">Utilisateurs</a>
                        <% if (user.role && (user.role.id === 'ADMIN' || user.role.id === 'DEVELOPER' || user.role.id === 'MODERATOR')) { %>
                            <a href="/admin" class="px-3 py-1.5 text-xs rounded-md border border-red-600/50 bg-red-700/30 hover:bg-red-700/40 text-red-100">Admin</a>
                        <% } %>
        </div>
        <div class="relative ml-1" id="profileMenu">
            <button id="profileMenuBtn" aria-haspopup="menu" aria-controls="profileMenuPanel" aria-expanded="false" class="flex items-center gap-2 px-2 py-1.5 rounded-full bg-slate-800/80 border border-fuchsia-700/40 hover:bg-slate-700/80 focus:outline-none focus:ring-2 focus:ring-fuchsia-600/40">
                    <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-fuchsia-700/70 text-sm font-semibold overflow-hidden" data-avatar>
                        <%- include('avatar.ejs', { user }) %>
                    </span>
                    <span class="hidden sm:inline text-sm font-medium max-w-28 truncate"><%= user.userName %></span>
                    <svg class="size-4 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.23 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
            </button>
                <div id="profileMenuPanel" class="absolute right-0 mt-2 w-72 origin-top-right divide-y divide-slate-700/50 rounded-xl border border-slate-700 bg-slate-900/95 backdrop-blur-xl shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none hidden transform transition-all duration-200 ease-out" role="menu">
    <div class="px-4 py-3">
        <p class="text-xs font-medium text-slate-400 uppercase tracking-wider">Compte</p>
        <div class="mt-2 flex items-center gap-3">
            <div class="h-9 w-9 rounded-full bg-slate-800 flex items-center justify-center overflow-hidden ring-2 ring-slate-700">
                 <%- include('avatar.ejs', { user }) %>
            </div>
            <div class="overflow-hidden">
                <p class="truncate text-sm font-medium text-white"><%= user.userName %></p>
                <p class="truncate text-xs text-slate-400"><%= user.email %></p>
            </div>
        </div>
    </div>
    
    <div class="p-1">
        <a href="/" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-white transition-colors">
            <svg class="h-5 w-5 text-slate-400 group-hover:text-violet-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            Tableau de bord
        </a>
        <a href="/edit" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-white transition-colors">
            <svg class="h-5 w-5 text-slate-400 group-hover:text-violet-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
            Éditer ma page
        </a>
        <a href="/stats" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-white transition-colors">
            <svg class="h-5 w-5 text-slate-400 group-hover:text-violet-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
            Statistiques
        </a>
        <a href="/cosmetics" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-white transition-colors">
            <svg class="h-5 w-5 text-slate-400 group-hover:text-violet-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>
            Cosmétiques
        </a>
    </div>

    <div class="p-1">
        <a href="/plinkks" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-white transition-colors">
            <svg class="h-5 w-5 text-slate-400 group-hover:text-violet-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
            Mes Plinkks
        </a>
        <a href="/themes" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-white transition-colors">
            <svg class="h-5 w-5 text-slate-400 group-hover:text-violet-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
            Mes Thèmes
        </a>
    </div>

    <div class="p-1">
        <a href="/account" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-white transition-colors">
            <svg class="h-5 w-5 text-slate-400 group-hover:text-violet-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
            Paramètres
        </a>
        <a target="_blank" href="<%= frontendUrl %>/<%= (typeof publicPath !== 'undefined' && publicPath) ? publicPath : user.id %>" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-white transition-colors">
            <svg class="h-5 w-5 text-slate-400 group-hover:text-violet-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
            Voir mon profil
        </a>
    </div>

    <div class="p-1">
        <a href="/logout" class="group flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-rose-400 hover:bg-rose-950/30 hover:text-rose-300 transition-colors">
            <svg class="h-5 w-5 text-rose-400/70 group-hover:text-rose-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
            Déconnexion
        </a>
    </div>
</div>
        </div>
    </div>
    <div id="spaTopLoaderDash" aria-hidden="true"><div class="prog" id="spaTopLoaderProgDash"></div></div>
</header>
<script>
    (function(){
    const el = document.getElementById('spaTopLoaderDash');
    const bar = document.getElementById('spaTopLoaderProgDash');
    let _active = false, _timer = null, _val = 0, _t0 = 0;
    const MIN_VISIBLE = 300; // ms
    function setProgress(p){ if (!bar) return; _val = Math.max(0, Math.min(100, p)); bar.style.width = _val + '%'; }
    function tick(){ if (!_active) return; const target = 80; const delta = Math.max(0.5, (target - _val) * 0.1); setProgress(_val + delta); _timer = setTimeout(tick, 200); }
    function start(){ if (!el || !bar) return; if (_active) return; _active = true; _t0 = Date.now(); el.classList.add('active'); setProgress(5); clearTimeout(_timer); _timer = setTimeout(tick, 160); }
    function end(){ if (!el || !bar) return; clearTimeout(_timer); setProgress(100); const elapsed = Date.now() - _t0; const extra = Math.max(0, MIN_VISIBLE - elapsed); setTimeout(()=>{ el.classList.remove('active'); setProgress(0); _active = false; }, 250 + extra); }
        if (!window.__spaLoadingStartDash) window.__spaLoadingStartDash = start;
        if (!window.__spaLoadingEndDash) window.__spaLoadingEndDash = end;
        window.addEventListener('spa:loading-start', start);
        window.addEventListener('spa:loading-end', end);
        window.addEventListener('beforeunload', ()=>{ try { sessionStorage.setItem('spa_nav','1'); start(); } catch{} });
        try {
            if (sessionStorage.getItem('spa_nav') === '1') {
                sessionStorage.removeItem('spa_nav');
                start();
                const fin = ()=> setTimeout(end, 120);
                if (document.readyState === 'complete') fin(); else window.addEventListener('load', fin, { once: true });
            }
        } catch {}
    })();
</script>
<script>
    (function(){
        const root = document.getElementById('profileMenu');
        const btn = document.getElementById('profileMenuBtn');
        const panel = document.getElementById('profileMenuPanel');
        if (!root || !btn || !panel) return;
        if (btn.dataset.bound === '1') return;
        btn.dataset.bound = '1';

        const open = () => {
            panel.classList.remove('hidden');
            panel.classList.add('animate-pop-in');
            btn.setAttribute('aria-expanded','true');
        };
        const close = () => {
            panel.classList.add('hidden');
            btn.setAttribute('aria-expanded','false');
        };

        btn.addEventListener('click', (e)=>{
            e.stopPropagation();
            if (panel.classList.contains('hidden')) open(); else close();
        });
        document.addEventListener('click', (e)=>{
            if (!root.contains(e.target)) close();
        });
        document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') close(); });
    })();
</script>
<script>
    (function(){
        try {
            const nodes = Array.from(document.querySelectorAll('[id^="siteMessageWrapDash_"] , #siteMessageWrapDash'));
            nodes.forEach((wrap) => {
                const raw = wrap.getAttribute('data-msg');
                if (!raw) return;
                const safe = raw.replace(/&#39;/g, "'");
                let msg = null; try { msg = JSON.parse(safe); } catch(e) {}
                if (!msg || !msg.id) return;
                const key = 'dismissed_site_message_' + msg.id;
                if (localStorage.getItem(key)) { wrap.style.display = 'none'; return; }
                const btn = wrap.querySelector('button[id^="dismissSiteMessageDash"]');
                if (btn) btn.addEventListener('click', ()=>{ localStorage.setItem(key,'1'); wrap.style.display='none'; });
            });
        } catch(e){}
    })();
</script>
<script>
    (function(){
        const el = document.getElementById('spaTopLoaderDash');
        function start(){ if (el) el.classList.add('active'); }
        function end(){ if (el) el.classList.remove('active'); }
        if (!window.__spaLoadingStartDash) window.__spaLoadingStartDash = start;
        if (!window.__spaLoadingEndDash) window.__spaLoadingEndDash = end;
        window.addEventListener('spa:loading-start', start);
        window.addEventListener('spa:loading-end', end);

        function isModifiedClick(e){ return e.metaKey || e.ctrlKey || e.shiftKey || e.altKey || e.button !== 0; }
        function isSameOrigin(url){ try { const u=new URL(url, location.href); return u.origin===location.origin; } catch { return false; } }
        function looksLikeHtmlRequest(url){ return isSameOrigin(url) && !/\.(?:png|jpe?g|webp|gif|svg|ico|css|js|map|json|txt|woff2?|ttf|otf)(?:[?#].*)?$/i.test(url); }
        document.addEventListener('click', (e)=>{
            const a = e.target && (e.target.closest ? e.target.closest('a') : null);
            if (!a) return; const href = a.getAttribute('href') || '';
            if (!href || href.startsWith('#')) return; if (a.target === '_blank' || a.download != null) return; if (isModifiedClick(e)) return;
            if (!looksLikeHtmlRequest(href)) return;
            try { window.dispatchEvent(new Event('spa:loading-start')); } catch {}
            setTimeout(()=>{ try { window.dispatchEvent(new Event('spa:loading-end')); } catch {} }, 8000);
        }, true);

        try {
            const origFetch = window.fetch.bind(window);
            let inflight = 0; const onBegin=()=>{ if (inflight++===0) window.dispatchEvent(new Event('spa:loading-start')); };
            const onEnd=()=>{ if (inflight>0 && --inflight===0) window.dispatchEvent(new Event('spa:loading-end')); };
            window.fetch = function(input, init){
                try {
                    const url = typeof input === 'string' ? input : (input && input.url) || '';
                    const method = (init && (init.method||'GET')) || (typeof input!=='string' && input && input.method) || 'GET';
                    const headers = new Headers((init && init.headers) || (typeof input!=='string' && input && input.headers) || undefined);
                    const accept = (headers.get('Accept') || headers.get('accept') || '').toLowerCase();
                    const isHtmlAccept = accept.includes('text/html') || accept === '';
                    const qualifies = method.toUpperCase()==='GET' && looksLikeHtmlRequest(url) && !url.startsWith('/api');
                    if (qualifies && isHtmlAccept) onBegin();
                    const p = origFetch(input, init);
                    if (qualifies && isHtmlAccept) { p.finally(()=>{ setTimeout(onEnd, 80); }); }
                    return p;
                } catch { return origFetch(input, init); }
            };
        } catch {}
    })();
</script>