<%- include('partials/head.ejs', { title: 'Système - Administration' , description: 'État du système et maintenance.' ,
    robots: 'noindex,nofollow' }) %>
    <%- include('partials/header-dash.ejs', { user: user }) %>

        <div class="max-w-[1600px] mx-auto grid grid-cols-12 gap-6 px-4 py-8">
            <%- include('partials/admin-nav.ejs', { user: user, active: 'system' }) %>

                <main class="col-span-12 lg:col-span-10 space-y-8 relative">
                    <!-- Dev Overlay -->


                    <div
                        class="flex flex-col md:flex-row md:items-center justify-between gap-4 bg-gradient-to-r from-slate-900 to-slate-800 p-8 rounded-3xl border border-slate-800 relative overflow-hidden">
                        <div
                            class="absolute top-0 right-0 w-64 h-64 bg-emerald-600/20 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none">
                        </div>
                        <div class="relative z-10">
                            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">Système & Maintenance</h1>
                            <p class="text-slate-400 text-lg">Surveillance des ressources et exécution de tâches.</p>
                        </div>
                    </div>

                    <!-- Health Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-slate-900 border border-slate-800 p-6 rounded-3xl">
                            <div class="text-slate-400 text-sm font-medium mb-2">Uptime</div>
                            <div class="text-2xl font-bold text-white" id="sysUptime">-</div>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 p-6 rounded-3xl">
                            <div class="text-slate-400 text-sm font-medium mb-2">Mémoire (RSS)</div>
                            <div class="text-2xl font-bold text-white" id="sysMem">-</div>
                            <div class="text-xs text-slate-500 mt-1" id="sysMemDetail"></div>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 p-6 rounded-3xl">
                            <div class="text-slate-400 text-sm font-medium mb-2">Node Version</div>
                            <div class="text-2xl font-bold text-white" id="sysNode">-</div>
                        </div>
                    </div>

                    <!-- Old Maintenance Control Removed -->
                    <div class="bg-slate-900 border border-slate-800 rounded-3xl p-6 mb-8">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-xl font-bold text-white">Mode Maintenance</h2>
                                <p class="text-sm text-slate-400 mt-1">
                                    La gestion de la maintenance a été déplacée.
                                </p>
                            </div>
                            <a href="/admin/maintenance"
                                class="px-6 py-3 bg-violet-600 text-white font-bold rounded-xl hover:bg-violet-700 transition-colors flex items-center gap-2">
                                Gérer la maintenance
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                    <polyline points="12 5 19 12 12 19"></polyline>
                                </svg>
                            </a>
                        </div>
                    </div>

                </main>
        </div>

        <script>
            let activePages = [];

            async function loadStats() {
                try {
                    const res = await fetch('/admin/system/api');
                    const data = await res.json();

                    document.getElementById('sysUptime').textContent = Math.floor(data.uptime / 60) + ' min';
                    document.getElementById('sysMem').textContent = Math.round(data.memory.rss / 1024 / 1024) + ' MB';
                    document.getElementById('sysMemDetail').textContent = `Heap: ${Math.round(data.memory.heapUsed / 1024 / 1024)} / ${Math.round(data.memory.heapTotal / 1024 / 1024)} MB`;
                    document.getElementById('sysNode').textContent = data.nodeVersion;
                } catch (e) {
                    console.error(e);
                }
            }

            loadStats();
            setInterval(loadStats, 10000);
        </script>
        </body>

        </html>