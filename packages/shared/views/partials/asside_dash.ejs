<%
    const _roleName = user && user.role ? (user.role.id || user.role.name) : null;
    const _isPremiumUser = !!(user && (user.isPremium || user.isPartner || (_roleName && ['ADMIN','DEVELOPER','MODERATOR'].includes(_roleName))));
    const _showPremiumUi = !!(user && user.showPremiumUi !== false);
%>
<aside id="dashboardSidebar" class="hidden lg:flex flex-col col-span-2 sticky top-[68px] h-[calc(100vh-80px)]">
    <!-- Unified Container -->
    <div class="flex-1 flex flex-col bg-slate-900/50 backdrop-blur-xl border border-slate-800/50 rounded-3xl p-4 shadow-xl overflow-y-auto no-scrollbar">
        
        <!-- Profile Section -->
        <div class="flex flex-col items-center text-center mb-6 pb-6 border-b border-slate-800/50">
            <div class="relative group cursor-pointer mb-3">
                <div class="relative h-20 w-20">
                    <%- include('avatar.ejs', { user: user }) %>
                </div>
                <a href="/settings" class="absolute bottom-0 right-0 z-10 bg-slate-800 text-white p-1.5 rounded-full border border-slate-700 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                </a>
            </div>
            <h3 class="font-bold text-white text-lg"><%= user && (user.userName || user.id) %></h3>
            <% if (_isPremiumUser && _showPremiumUi) { %>
                <div class="mt-2 inline-flex items-center gap-1.5 rounded-full bg-amber-500/10 text-amber-300 border border-amber-500/30 px-2.5 py-0.5 text-[10px] font-bold uppercase tracking-wider">
                    <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l2.7 5.48 6.05.88-4.38 4.27 1.03 6.02L12 15.9 6.6 18.65l1.03-6.02L3.25 8.36l6.05-.88L12 2z"/></svg>
                    Premium
                </div>
            <% } %>
            <% 
                let displayEmail = null;
                if (typeof plinkk !== 'undefined' && plinkk) {
                    if (typeof plinkk.affichageEmail !== 'undefined') displayEmail = plinkk.affichageEmail;
                    else if (plinkk.settings && Object.prototype.hasOwnProperty.call(plinkk.settings, 'affichageEmail')) displayEmail = plinkk.settings.affichageEmail;
                }
                if (displayEmail === null || typeof displayEmail === 'undefined') {
                    displayEmail = (user && ((user.publicEmail) ? user.publicEmail : user.email)) || null;
                }
            %>
            <% if (displayEmail) { %>
                <p class="text-xs text-slate-400 mt-1"><%= displayEmail %></p>
            <% } %>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 space-y-6">
            <% const isActive = (k) => (typeof active !== 'undefined' && active === k); %>
            
            <!-- General -->
            <div class="space-y-1">
                <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2">Général</p>
                <a href="/" class="flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('dashboard') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2L2 8v10a1 1 0 001 1h5V11h4v8h5a1 1 0 001-1V8l-8-6z"/></svg>
                    <span class="font-medium">Accueil</span>
                </a>
                <a href="/stats" class="flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('stats') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M3 13h2v4H3v-4zm4-6h2v10H7V7zm4 4h2v6h-2v-6zm4-8h2v14h-2V3z"/></svg>
                    <span class="font-medium">Statistiques</span>
                </a>
            </div>

            <!-- Content -->
            <div class="space-y-1">
                <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2">Personnalisation</p>
                <a href="/edit" class="flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('edit') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    <span class="font-medium">Éditeur</span>
                </a>
                <a href="/cosmetics" class="flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('cosmetics') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>
                    <span class="font-medium">Cosmétiques</span>
                </a>
                <a href="/themes" class="flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('themes') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="8" height="8" rx="1.5" opacity="0.95"/><rect x="13" y="3" width="8" height="8" rx="1.5" opacity="0.65"/><rect x="3" y="13" width="8" height="8" rx="1.5" opacity="0.65"/><rect x="13" y="13" width="8" height="8" rx="1.5" opacity="0.35"/></svg>
                    <span class="font-medium">Thèmes</span>
                </a>
                <a href="/plinkks" class="flex items-center justify-between px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('plinkks') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <div class="flex items-center gap-3">
                        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                        <span class="font-medium">Mes Plinkks</span>
                    </div>
                    <% if (typeof plinkkCount !== 'undefined' && plinkkCount > 0) { %>
                        <span class="bg-slate-800 text-slate-300 text-[10px] font-bold px-2 py-0.5 rounded-full border border-slate-700"><%= plinkkCount %></span>
                    <% } %>
                </a>
                <a href="/redirects" class="flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('redirects') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                    <span class="font-medium">Redirections</span>
                </a>
            </div>

            <!-- Account -->
            <div class="space-y-1">
                <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2">Compte</p>
                <a href="/account" class="flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('account') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a4 4 0 100 8 4 4 0 000-8zM2 18a8 8 0 0116 0H2z"/></svg>
                    <span class="font-medium">Paramètres</span>
                </a>
                <a href="/sessions" class="flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 <%= isActive('sessions') ? 'bg-violet-500/10 text-violet-400 border border-violet-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/50' %>">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                    <span class="font-medium">Sessions</span>
                </a>
            </div>
        </nav>

        <!-- Pro Tip (Simplified) -->
        <!-- 
        <% if (active === 'dashboard') { %>
            <div class="mt-6 p-4 rounded-2xl bg-gradient-to-br from-amber-500/10 to-orange-500/5 border border-amber-500/20">
                <div class="flex items-start gap-3">
                    <div class="p-2 bg-amber-500/10 rounded-lg text-amber-400">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    </div>
                    <div>
                        <p class="text-xs font-semibold text-amber-200 mb-1">Astuce Pro</p>
                        <p class="text-[11px] text-amber-200/70 leading-relaxed">L'enregistrement est automatique dans l'éditeur.</p>
                    </div>
                </div>
            </div>
        <% } %>
            -->
    </div>
</aside>
