<aside id="dashboardSidebar" class="hidden lg:block col-span-3">
    <div class="sticky top-[68px] space-y-4">
        <% const isActive = (k) => (typeof active !== 'undefined' && active === k); %>

        <!-- User card -->
        <div class="rounded-xl border border-slate-800/60 bg-slate-900/60 p-3 shadow-sm">
            <div class="flex items-center gap-3">
                <div class="h-12 w-12 rounded-full overflow-hidden grid place-items-center bg-indigo-700/70 font-semibold text-white" data-avatar>
                    <%- include('avatar.ejs', { user: user }) %>
                </div>
                <div class="min-w-0">
                    <p class="font-medium truncate text-sm"><%= user && (user.userName || user.id) %></p>
                    <% 
                        // Déterminer l'email affiché: priorité à la plinkk (affichageEmail), sinon user.publicEmail, sinon user.email
                        let displayEmail = null;
                        if (typeof plinkk !== 'undefined' && plinkk) {
                          // Respecter explicitement la valeur présente dans settings (même null => suppression)
                          if (typeof plinkk.affichageEmail !== 'undefined') displayEmail = plinkk.affichageEmail;
                          else if (plinkk.settings && Object.prototype.hasOwnProperty.call(plinkk.settings, 'affichageEmail')) displayEmail = plinkk.settings.affichageEmail;
                        }
                        if (displayEmail === null || typeof displayEmail === 'undefined') {
                          displayEmail = (user && ((user.publicEmail) ? user.publicEmail : user.email)) || null;
                        }
                    %>
                    <% if (displayEmail) { %>
                        <p class="text-xs text-slate-400 truncate"><%= displayEmail %></p>
                    <% } %>
                </div>
                <a href="/dashboard/edit" class="ml-auto text-xs px-2 py-1 rounded-md bg-slate-800/50 hover:bg-slate-800/70 text-slate-200">Éditer</a>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="rounded-xl border border-slate-800/60 bg-slate-900/60 p-2 divide-y divide-slate-800/40 shadow-sm">
            <div class="py-2 space-y-1">
                <p class="px-3 text-xs text-slate-400 uppercase tracking-wide">Général</p>
                <a href="/dashboard" class="group flex items-center gap-3 px-3 py-2 rounded-md transition-colors <%= isActive('dashboard') ? 'bg-slate-800/60 text-white' : 'hover:bg-slate-800/60' %>" aria-current="<%= isActive('dashboard') ? 'page' : 'false' %>">
                    <svg class="h-4 w-4 text-slate-300" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2L2 8v10a1 1 0 001 1h5V11h4v8h5a1 1 0 001-1V8l-8-6z"/></svg>
                    <span class="text-sm truncate">Accueil</span>
                </a>

                <a href="/dashboard/edit" class="group flex items-center gap-3 px-3 py-2 rounded-md transition-colors <%= isActive('edit') ? 'bg-slate-800/60 text-white' : 'hover:bg-slate-800/60' %>" aria-current="<%= isActive('edit') ? 'page' : 'false' %>">
                    <svg class="h-4 w-4 text-slate-300" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 010 2.828L8.414 14.414 5 15l.586-3.414L17.414 2.586z"/></svg>
                    <span class="text-sm truncate">Éditer</span>
                </a>

                <a href="/dashboard/stats" class="group flex items-center gap-3 px-3 py-2 rounded-md transition-colors <%= isActive('stats') ? 'bg-slate-800/60 text-white' : 'hover:bg-slate-800/60' %>" aria-current="<%= isActive('stats') ? 'page' : 'false' %>">
                    <svg class="h-4 w-4 text-slate-300" viewBox="0 0 20 20" fill="currentColor"><path d="M3 13h2v4H3v-4zm4-6h2v10H7V7zm4 4h2v6h-2v-6zm4-8h2v14h-2V3z"/></svg>
                    <span class="text-sm truncate">Statistiques</span>
                </a>
            </div>

            <div class="py-2 space-y-1">
                <p class="px-3 text-xs text-slate-400 uppercase tracking-wide">Contenu</p>
                <a href="/dashboard/cosmetics" class="group flex items-center gap-3 px-3 py-2 rounded-md transition-colors <%= isActive('cosmetics') ? 'bg-slate-800/60 text-white' : 'hover:bg-slate-800/60' %>" aria-current="<%= isActive('cosmetics') ? 'page' : 'false' %>">
                    <svg class="h-4 w-4 text-slate-300" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M3 21c0 .6.4 1 1 1 .2 0 .4 0 .6-.1l3.9-1.3 8.1-8.1c.6-.6.9-1.4.7-2.2l-1-3.6a2.1 2.1 0 00-2.2-1.5 2 2 0 00-1.3.6L3.3 14.7A2 2 0 003 16v5z" opacity="0.12"/>
                        <path d="M7.7 17.3l7.9-7.9 2.4 2.4-7.9 7.9-2.4-2.4zM14.6 6.4l2.4-2.4a1 1 0 011.4 0l1.1 1.1a1 1 0 010 1.4l-2.4 2.4" />
                    </svg>
                    <span class="text-sm truncate">Cosmétiques</span>
                </a>

                <a href="/dashboard/themes" class="group flex items-center gap-3 px-3 py-2 rounded-md transition-colors <%= isActive('themes') ? 'bg-slate-800/60 text-white' : 'hover:bg-slate-800/60' %>" aria-current="<%= isActive('themes') ? 'page' : 'false' %>">
                    <svg class="h-4 w-4 text-slate-300" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <rect x="3" y="3" width="8" height="8" rx="1.5" opacity="0.95"/>
                        <rect x="13" y="3" width="8" height="8" rx="1.5" opacity="0.65"/>
                        <rect x="3" y="13" width="8" height="8" rx="1.5" opacity="0.65"/>
                        <rect x="13" y="13" width="8" height="8" rx="1.5" opacity="0.35"/>
                    </svg>
                    <span class="text-sm truncate">Mes thèmes</span>
                </a>

                <a href="/dashboard/plinkks" class="group flex items-center justify-between gap-3 px-3 py-2 rounded-md transition-colors <%= isActive('plinkks') ? 'bg-slate-800/60 text-white' : 'hover:bg-slate-800/60' %>" aria-current="<%= isActive('plinkks') ? 'page' : 'false' %>">
                    <span class="flex items-center gap-3">
                        <svg class="h-4 w-4 text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M7 3h7l5 5v11a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/>
                            <path d="M9 8h6M9 12h6M9 16h3" />
                            <path d="M19 8l2 2-2 2" />
                        </svg>
                        <span class="text-sm truncate">Mes plinkks</span>
                    </span>
                    <% if (typeof plinkkCount !== 'undefined') { %>
                        <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-slate-800/50 text-slate-200"><%= plinkkCount %></span>
                    <% } %>
                </a>
            </div>

            <div class="py-2 space-y-1">
                <p class="px-3 text-xs text-slate-400 uppercase tracking-wide">Compte</p>
                <a href="/dashboard/account" class="group flex items-center gap-3 px-3 py-2 rounded-md transition-colors <%= isActive('account') ? 'bg-slate-800/60 text-white' : 'hover:bg-slate-800/60' %>" aria-current="<%= isActive('account') ? 'page' : 'false' %>">
                    <svg class="h-4 w-4 text-slate-300" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a4 4 0 100 8 4 4 0 000-8zM2 18a8 8 0 0116 0H2z"/></svg>
                    <span class="text-sm truncate">Compte</span>
                </a>
            </div>
        </nav>

        <% if (active === 'dashboard') { %>
            <div class="rounded-xl border border-slate-800/60 bg-gradient-to-br from-amber-500/10 to-amber-400/5 p-3 shadow-sm">
                <p class="text-sm font-medium text-amber-200">Astuce</p>
                <p class="text-xs text-amber-100/90 mt-1">Active l’enregistrement automatique dans l’éditeur pour ne jamais perdre tes changements.</p>
                <a href="/dashboard/edit" class="mt-2 inline-flex items-center gap-1 text-xs text-amber-200 hover:text-amber-100">Ouvrir l’éditeur
                    <svg class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path d="M12.293 2.293a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L14 5.414V17a1 1 0 11-2 0V5.414L9.707 7.707A1 1 0 018.293 6.293l4-4z"/></svg>
                </a>
            </div>
        <% } %>
    </div>
</aside>