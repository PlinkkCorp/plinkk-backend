generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                    String               @id @unique
  userName              String
  password              String
  email                 String               @unique
  publicEmail           String?
  mustChangePassword    Boolean              @default(false)
  twoFactorEnabled      Boolean              @default(false)
  twoFactorSecret       String?
  name                  String
  emailVerified         Boolean              @default(false)
  image                 String?
  lastLogin             DateTime             @default(now())
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @default(now()) @updatedAt
  roleId                String?
  rankScore             Int                  @default(0)
  bumpedAt              DateTime?
  bumpExpiresAt         DateTime?
  bumpPaidUntil         DateTime?
  isPublic              Boolean              @default(true)
  views                 Int                  @default(0)
  isVerified            Boolean              @default(false)
  isPartner             Boolean              @default(false)
  selectedCustomThemeId String?
  slags                 Json                 @default("[]")
  apiKey                String?              @unique
  hasPassword           Boolean              @default(true)
  isPremium             Boolean              @default(false)
  premiumUntil          DateTime?
  extraPlinkks          Int                  @default(0)
  extraRedirects        Int                  @default(0)
  stripeCustomerId      String?              @unique
  showPremiumUi         Boolean              @default(true)
  premiumSource         String?
  gravatarEmailSource   GravatarSource       @default(PRIMARY)
  announcement          AnnouncementTarget[]
  backgroundColors      BackgroundColor[]
  connections           Connection[]
  cosmetics             Cosmetic?
  labels                Label[]
  links                 Link[]
  neonColors            NeonColor[]
  plinkks               Plinkk[]
  purchases             Purchase[]
  redirects             Redirect[]
  reportsReceived       Report[]             @relation("ReportedUser")
  reportsMade           Report[]             @relation("Reporter")
  sessions              Session[]
  socialIcons           SocialIcon[]
  statusbar             Statusbar?
  themes                Theme[]
  role                  Role?                @relation(fields: [roleId], references: [id])
  userLogs              UserLog[]
}

model Connection {
  id           String    @id @default(nanoid(16))
  provider     String
  providerId   String
  email        String?
  name         String?
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  userId       String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
  isIdentity   Boolean   @default(false)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerId])
  @@unique([provider, userId])
}

model MagicLink {
  token     String   @id
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model Session {
  id           String   @id @default(nanoid(16))
  userId       String
  ip           String?
  userAgent    String?
  currentPath  String?
  lastActiveAt DateTime @default(now())
  createdAt    DateTime @default(now())
  expiresAt    DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Report {
  id               String   @id @default(nanoid(16))
  reason           String
  message          String?
  status           String   @default("PENDING")
  reporterId       String
  reportedUserId   String?
  reportedPlinkkId String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @updatedAt
  reportedPlinkk   Plinkk?  @relation(fields: [reportedPlinkkId], references: [id])
  reportedUser     User?    @relation("ReportedUser", fields: [reportedUserId], references: [id])
  reporter         User     @relation("Reporter", fields: [reporterId], references: [id])
}

model Role {
  id                     String                   @id @default(nanoid(16))
  name                   String                   @unique
  isStaff                Boolean                  @default(false)
  priority               Int                      @default(0)
  color                  String?
  maxPlinkks             Int?                     @default(1)
  maxThemes              Int?                     @default(0)
  limits                 Json?
  meta                   Json?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @default(now()) @updatedAt
  maxRedirects           Int?                     @default(5)
  AnnouncementRoleTarget AnnouncementRoleTarget[]
  permissions            RolePermission[]
  users                  User[]
}

model Permission {
  key         String           @id
  category    String
  description String?
  system      Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @default(now()) @updatedAt
  roles       RolePermission[]
}

model RolePermission {
  roleId        String
  permissionKey String
  grantedAt     DateTime   @default(now())
  permission    Permission @relation(fields: [permissionKey], references: [key], onDelete: Cascade)
  role          Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([roleId, permissionKey])
}

model Cosmetic {
  id        String  @id @default(nanoid(16))
  flair     String? @default("OG")
  frame     String? @default("none")
  theme     String? @default("system")
  bannerUrl String? @default("")
  banner    String? @default("")
  data      Json?
  userId    String  @unique
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Link {
  id                     String    @id @default(nanoid(16))
  icon                   String?   @default("https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png")
  url                    String    @default("https://github.com/link")
  text                   String?   @default("Link")
  name                   String?   @default("Github")
  description            String?   @default("Ma description")
  showDescriptionOnHover Boolean?  @default(true)
  showDescription        Boolean?  @default(true)
  clicks                 Int       @default(0)
  userId                 String
  plinkkId               String?
  categoryId             String?
  expiresAt              DateTime?
  scheduledAt            DateTime?
  buttonTheme            String?   @default("system")
  androidUrl             String?
  clickLimit             Int?
  embedData              Json?
  forceAppOpen           Boolean?  @default(false)
  formData               Json?
  iosUrl                 String?
  type                   String?   @default("LINK")
  index                  Int       @default(0)
  category               Category? @relation(fields: [categoryId], references: [id])
  plinkk                 Plinkk?   @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
  user                   User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Category {
  id        String   @id @default(nanoid(16))
  name      String
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  plinkkId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  plinkk    Plinkk   @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
  links     Link[]
}

model Host {
  id          String  @id
  verified    Boolean @default(false)
  verifyToken String  @unique
  plinkkId    String  @unique
  plinkk      Plinkk  @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
}

model Label {
  id        String  @id @default(nanoid(16))
  data      String  @default("Developer")
  color     String  @default("#FF6384")
  fontColor String  @default("#FFFFFF")
  userId    String
  plinkkId  String?
  plinkk    Plinkk? @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SocialIcon {
  id       String  @id @default(nanoid(16))
  url      String  @default("https://github.com")
  icon     String  @default("Github")
  userId   String
  plinkkId String?
  plinkk   Plinkk? @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model BackgroundColor {
  id       String  @id @default(nanoid(16))
  color    String  @default("#FF5733")
  userId   String
  plinkkId String?
  plinkk   Plinkk? @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model NeonColor {
  id       String  @id @default(nanoid(16))
  color    String  @default("#7289DA")
  userId   String
  plinkkId String?
  plinkk   Plinkk? @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Statusbar {
  id            String  @id @default(nanoid(16))
  text          String? @default("Hello World!")
  colorBg       String? @default("#222222")
  colorText     String? @default("#cccccc")
  fontTextColor Int?    @default(1)
  statusText    String? @default("busy")
  userId        String  @unique
  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PlinkkStatusbar {
  id            String  @id @default(nanoid(16))
  text          String? @default("Hello World!")
  colorBg       String? @default("#222222")
  colorText     String? @default("#cccccc")
  fontTextColor Int?    @default(1)
  statusText    String? @default("busy")
  plinkkId      String  @unique
  plinkk        Plinkk  @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
}

model Announcement {
  id          String                   @id @default(nanoid(16))
  level       String                   @default("info")
  text        String
  dismissible Boolean                  @default(true)
  startAt     DateTime?
  endAt       DateTime?
  createdAt   DateTime                 @default(now())
  global      Boolean                  @default(false)
  displayType String                   @default("banner")
  platform    String                   @default("all")
  roleTargets AnnouncementRoleTarget[]
  targets     AnnouncementTarget[]
}

model AnnouncementTarget {
  announcementId String
  userId         String
  announcement   Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([announcementId, userId])
}

model AnnouncementRoleTarget {
  announcementId String
  roleId         String
  announcement   Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  role           Role         @relation(fields: [roleId], references: [id])

  @@id([announcementId, roleId])
}

model Theme {
  id                   String      @id @default(nanoid(16))
  name                 String
  description          String?
  data                 Json
  status               ThemeStatus @default(DRAFT)
  isPrivate            Boolean     @default(false)
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @default(now()) @updatedAt
  pendingUpdate        Json?
  pendingUpdateAt      DateTime?
  pendingUpdateMessage String?
  authorId             String
  author               User        @relation(fields: [authorId], references: [id], onDelete: Cascade)
}

model Plinkk {
  id           String            @id @default(nanoid(16))
  userId       String
  name         String
  slug         String
  index        Int               @default(0)
  isDefault    Boolean           @default(false)
  isPublic     Boolean           @default(true)
  visibility   Visibility        @default(PUBLIC)
  isActive     Boolean           @default(true)
  views        Int               @default(0)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @default(now()) @updatedAt
  passwordHash String?
  background   BackgroundColor[]
  categories   Category[]
  host         Host?
  labels       Label[]
  links        Link[]
  neonColors   NeonColor[]
  pageStats    PageStat[]        @relation("PageStats")
  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  settings     PlinkkSettings?
  statusbar    PlinkkStatusbar?
  versions     PlinkkVersion[]
  reports      Report[]
  socialIcons  SocialIcon[]

  @@unique([userId, slug])
  @@unique([userId, index])
}

model PlinkkSettings {
  id                               String  @id @default(nanoid(16))
  plinkkId                         String  @unique
  profileLink                      String?
  profileImage                     String?
  profileIcon                      String?
  profileSiteText                  String?
  userName                         String?
  iconUrl                          String?
  description                      String?
  profileHoverColor                String?
  affichageEmail                   String?
  publicPhone                      String?
  showVerifiedBadge                Boolean @default(true)
  showPartnerBadge                 Boolean @default(true)
  enableVCard                      Boolean @default(true)
  enableLinkCategories             Boolean @default(false)
  degBackgroundColor               Int?
  neonEnable                       Int?
  buttonThemeEnable                Int?
  EnableAnimationArticle           Int?
  EnableAnimationButton            Int?
  EnableAnimationBackground        Int?
  backgroundSize                   Int?
  selectedThemeIndex               Int?
  selectedAnimationIndex           Int?
  selectedAnimationButtonIndex     Int?
  selectedAnimationBackgroundIndex Int?
  animationDurationBackground      Int?
  delayAnimationButton             Float?
  canvaEnable                      Int?
  selectedCanvasIndex              Int?
  fontFamily                       String?
  buttonStyle                      String?
  layoutOrder                      Json?   @default("[\"profile\", \"username\", \"statusbar\", \"labels\", \"social\", \"email\", \"links\"]")
  plinkk                           Plinkk  @relation(fields: [plinkkId], references: [id], onDelete: Cascade)
}

model PlinkkEvent {
  id        String          @id @default(nanoid(16))
  type      PlinkkEventType
  userId    String
  plinkkId  String
  createdAt DateTime        @default(now())
}

model UserViewDaily {
  userId String
  date   DateTime @default(now())
  count  Int

  @@id([userId, date])
  @@map("UserViewDaily")
}

model LinkClickDaily {
  linkId String
  date   DateTime @default(now())
  count  Int

  @@id([linkId, date])
  @@map("LinkClickDaily")
}

model PlinkkViewDaily {
  plinkkId String
  date     DateTime @default(now())
  count    Int

  @@id([plinkkId, date])
  @@map("PlinkkViewDaily")
}

model PageStat {
  id        String   @id @default(nanoid(16))
  plinkkId  String
  eventType String
  meta      Json?
  ip        String?
  createdAt DateTime @default(now())
  plinkk    Plinkk   @relation("PageStats", fields: [plinkkId], references: [id], onDelete: Cascade)

  @@index([plinkkId, eventType, createdAt])
}

model BannedSlug {
  slug      String   @id
  reason    String?
  createdAt DateTime @default(now())
}

model BannedEmail {
  email        String    @id
  reason       String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
  deletePlinkk Boolean   @default(false)
  time         Int?      @default(-1)
  revoquedAt   DateTime?
}

model AdminLog {
  id        String   @id @default(nanoid(16))
  adminId   String
  action    String
  targetId  String?
  details   Json?
  createdAt DateTime @default(now())
  ip        String?
}

model UserLog {
  id        String   @id @default(nanoid(16))
  userId    String
  action    String
  targetId  String?
  details   Json?
  createdAt DateTime @default(now())
  ip        String?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model PlinkkVersion {
  id        String   @id @default(nanoid(16))
  plinkkId  String
  snapshot  Json
  label     String?
  createdAt DateTime @default(now())
  plinkk    Plinkk   @relation(fields: [plinkkId], references: [id], onDelete: Cascade)

  @@index([plinkkId])
  @@index([createdAt])
}

model Redirect {
  id          String               @id @default(nanoid(16))
  slug        String               @unique
  targetUrl   String
  title       String?
  description String?
  clicks      Int                  @default(0)
  isActive    Boolean              @default(true)
  userId      String
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @default(now()) @updatedAt
  expiresAt   DateTime?
  user        User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  dailyStats  RedirectClickDaily[]

  @@index([userId])
  @@index([slug])
}

model RedirectClickDaily {
  redirectId String
  date       DateTime @default(now())
  count      Int
  redirect   Redirect @relation(fields: [redirectId], references: [id], onDelete: Cascade)

  @@id([redirectId, date])
  @@map("RedirectClickDaily")
}

model Purchase {
  id              String   @id @default(nanoid(16))
  userId          String
  type            String
  amount          Int      @default(100)
  quantity        Int      @default(1)
  stripeSessionId String?  @unique
  stripePaymentId String?
  createdAt       DateTime @default(now())
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Maintenance {
  id               String    @id @default("config")
  global           Boolean   @default(false)
  dashboard        Boolean   @default(false)
  activePages      String[]  @default([])
  reason           String?
  updatedAt        DateTime  @updatedAt
  allowedIps       String[]  @default([])
  allowedRoles     String[]  @default([])
  scheduledEnd     DateTime?
  scheduledStart   DateTime?
  maintenancePages String[]  @default([])
}

enum ThemeStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  ARCHIVED
}

enum Visibility {
  PUBLIC
  PRIVATE
}

enum PlinkkEventType {
  CREATED
  DELETED
}

enum GravatarSource {
  PRIMARY
  PUBLIC
}
