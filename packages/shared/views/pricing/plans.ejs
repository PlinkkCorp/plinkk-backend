<% const _ctx=(typeof pricingContext !=='undefined' ) ? pricingContext : 'public' ; const
    isConfig=_ctx==='dashboard-config' ; const isDashPreview=_ctx==='dashboard-preview' ; const isPublic=!isConfig &&
    !isDashPreview; %>

    <% if (isPublic) { %>
        <!-- ═══════════════════ PUBLIC PRICING ═══════════════════ -->
        <section id="plans" class="py-20 relative">

            <!-- Header -->
            <div class="text-center mb-16">
                <div
                    class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-violet-500/10 border border-violet-500/20 text-violet-400 text-xs font-semibold uppercase tracking-widest mb-6">
                    <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                    </svg>
                    Tarifs
                </div>
                <h2 class="text-3xl md:text-4xl font-extrabold text-white mb-4 leading-tight">
                    Choisissez votre formule
                </h2>
                <p class="text-lg text-slate-400 max-w-lg mx-auto">
                    Un plan gratuit pour démarrer, des options Premium pour aller plus loin.
                </p>
            </div>

            <!-- Plans Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 max-w-6xl mx-auto px-4">

                <!-- Free Plan -->
                <div
                    class="relative group rounded-2xl border border-white/[0.06] bg-white/[0.02] backdrop-blur-sm p-7 flex flex-col hover:border-white/10 transition-all duration-300">
                    <div class="flex items-center gap-3 mb-5">
                        <div class="w-10 h-10 rounded-xl bg-slate-700/50 grid place-items-center">
                            <svg class="w-5 h-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </div>
                        <h3 class="text-base font-bold text-white">Gratuit</h3>
                    </div>

                    <div class="flex items-baseline gap-1 mb-6">
                        <span class="text-3xl font-extrabold text-white">0€</span>
                        <span class="text-sm text-slate-500">/ toujours</span>
                    </div>

                    <ul class="space-y-3 mb-8 flex-1 text-sm">
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>1 page Plinkk</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Liens illimités</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Thèmes de base</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Stats 7 jours</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>1 redirection</li>
                    </ul>

                    <a href="<%= typeof dashboardUrl !== 'undefined' ? dashboardUrl : '' %>/login#signup"
                        class="block w-full py-3 rounded-xl border border-slate-700 text-slate-300 font-semibold text-center text-sm hover:bg-white/5 transition-all">
                        Commencer
                    </a>
                </div>

                <!-- Monthly Plan -->
                <div
                    class="relative group rounded-2xl border border-violet-500/30 bg-gradient-to-b from-violet-500/[0.06] to-transparent backdrop-blur-sm p-7 flex flex-col shadow-lg shadow-violet-500/5 hover:shadow-violet-500/10 transition-all duration-300">
                    <!-- Popular badge -->
                    <div class="absolute -top-3 left-1/2 -translate-x-1/2">
                        <span
                            class="px-3.5 py-1 rounded-full bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white text-[10px] font-bold uppercase tracking-wider shadow-lg shadow-violet-900/40">Populaire</span>
                    </div>

                    <div class="flex items-center gap-3 mb-5">
                        <div class="w-10 h-10 rounded-xl bg-violet-500/15 grid place-items-center">
                            <svg class="w-5 h-5 text-violet-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                            </svg>
                        </div>
                        <h3 class="text-base font-bold text-white">Mensuel</h3>
                    </div>

                    <div class="flex items-baseline gap-1 mb-6">
                        <span class="text-3xl font-extrabold text-white">4,99€</span>
                        <span class="text-sm text-slate-500">/ mois</span>
                    </div>

                    <ul class="space-y-3 mb-8 flex-1 text-sm">
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-violet-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg><strong class="text-white">5</strong> pages Plinkk</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-violet-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg><strong class="text-white">10</strong> redirections</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-violet-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Tous les thèmes</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-violet-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Stats 365 jours</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-violet-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Extensions modulables</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-violet-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Badge Premium</li>
                    </ul>

                    <a href="<%= typeof dashboardUrl !== 'undefined' ? dashboardUrl : '' %>/premium/configure"
                        class="block w-full py-3 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-semibold text-center text-sm shadow-lg shadow-violet-900/30 hover:shadow-violet-900/50 hover:-translate-y-0.5 transition-all active:scale-[0.97]">
                        Choisir ce plan
                    </a>
                </div>

                <!-- Yearly Plan -->
                <div
                    class="relative group rounded-2xl border border-emerald-500/20 bg-gradient-to-b from-emerald-500/[0.04] to-transparent backdrop-blur-sm p-7 flex flex-col hover:border-emerald-500/30 transition-all duration-300">
                    <div class="absolute -top-3 left-1/2 -translate-x-1/2">
                        <span
                            class="px-3.5 py-1 rounded-full bg-emerald-500 text-white text-[10px] font-bold uppercase tracking-wider shadow-lg">−17%</span>
                    </div>

                    <div class="flex items-center gap-3 mb-5">
                        <div class="w-10 h-10 rounded-xl bg-emerald-500/15 grid place-items-center">
                            <svg class="w-5 h-5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                            </svg>
                        </div>
                        <h3 class="text-base font-bold text-white">Annuel</h3>
                    </div>

                    <div class="flex items-baseline gap-1 mb-2">
                        <span class="text-3xl font-extrabold text-white">49,90€</span>
                        <span class="text-sm text-slate-500">/ an</span>
                    </div>
                    <p class="text-xs text-emerald-400 font-medium mb-6">≈ 4,16€/mois — 2 mois offerts</p>

                    <ul class="space-y-3 mb-8 flex-1 text-sm">
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Tout le plan Mensuel</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Extensions incluses</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-emerald-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Support prioritaire</li>
                    </ul>

                    <a href="<%= typeof dashboardUrl !== 'undefined' ? dashboardUrl : '' %>/premium/configure"
                        class="block w-full py-3 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white font-semibold text-center text-sm transition-all active:scale-[0.97]">
                        Choisir ce plan
                    </a>
                </div>

                <!-- Lifetime Plan -->
                <div
                    class="relative group rounded-2xl border border-amber-500/20 bg-gradient-to-b from-amber-500/[0.04] to-transparent backdrop-blur-sm p-7 flex flex-col hover:border-amber-500/30 transition-all duration-300">
                    <div class="absolute -top-3 left-1/2 -translate-x-1/2">
                        <span
                            class="px-3.5 py-1 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 text-white text-[10px] font-bold uppercase tracking-wider shadow-lg">À
                            vie</span>
                    </div>

                    <div class="flex items-center gap-3 mb-5">
                        <div class="w-10 h-10 rounded-xl bg-amber-500/15 grid place-items-center">
                            <svg class="w-5 h-5 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 00-2.455 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                            </svg>
                        </div>
                        <h3 class="text-base font-bold text-white">Lifetime</h3>
                    </div>

                    <div class="flex items-baseline gap-1 mb-2">
                        <span class="text-3xl font-extrabold text-white">75€</span>
                        <span class="text-sm text-slate-500">une fois</span>
                    </div>
                    <p class="text-xs text-amber-400 font-medium mb-6">Paiement unique, accès à vie</p>

                    <ul class="space-y-3 mb-8 flex-1 text-sm">
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-amber-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Tout inclus, pour toujours</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-amber-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Futures fonctionnalités</li>
                        <li class="flex items-center gap-2.5 text-slate-300"><svg
                                class="w-4 h-4 text-amber-400 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Aucun renouvellement</li>
                    </ul>

                    <a href="<%= typeof dashboardUrl !== 'undefined' ? dashboardUrl : '' %>/premium/configure"
                        class="block w-full py-3 rounded-xl bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-semibold text-center text-sm transition-all active:scale-[0.97]">
                        Choisir ce plan
                    </a>
                </div>

            </div>
        </section>

        <% } else if (isDashPreview) { %>
            <!-- ═══════════════════ DASHBOARD PREVIEW ═══════════════════ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">

                <!-- Free -->
                <div class="rounded-2xl border border-white/[0.06] bg-white/[0.02] p-6 flex flex-col">
                    <div class="flex items-center gap-2.5 mb-4">
                        <div class="w-8 h-8 rounded-lg bg-slate-700/50 grid place-items-center"><svg
                                class="w-4 h-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg></div>
                        <h3 class="font-semibold text-white">Gratuit</h3>
                    </div>
                    <div class="flex items-baseline gap-1 mb-5">
                        <span class="text-2xl font-extrabold text-white">0€</span>
                        <span class="text-xs text-slate-500">/toujours</span>
                    </div>
                    <ul class="space-y-2 mb-6 flex-1 text-xs text-slate-400">
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-emerald-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>1 page • Liens illimités</li>
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-emerald-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Thèmes de base • Stats 7j</li>
                    </ul>
                    <div
                        class="py-2.5 rounded-xl border border-slate-800 text-slate-500 text-center text-sm font-medium">
                        Plan actuel</div>
                </div>

                <!-- Monthly -->
                <div
                    class="rounded-2xl border border-violet-500/30 bg-gradient-to-b from-violet-500/[0.06] to-transparent p-6 flex flex-col shadow-lg shadow-violet-500/5 relative">
                    <div class="absolute -top-2.5 left-1/2 -translate-x-1/2"><span
                            class="px-3 py-0.5 rounded-full bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white text-[9px] font-bold uppercase tracking-wider">Populaire</span>
                    </div>
                    <div class="flex items-center gap-2.5 mb-4">
                        <div class="w-8 h-8 rounded-lg bg-violet-500/15 grid place-items-center"><svg
                                class="w-4 h-4 text-violet-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                            </svg></div>
                        <h3 class="font-semibold text-white">Mensuel</h3>
                    </div>
                    <div class="flex items-baseline gap-1 mb-5">
                        <span class="text-2xl font-extrabold text-white">4,99€</span>
                        <span class="text-xs text-slate-500">/mois</span>
                    </div>
                    <ul class="space-y-2 mb-6 flex-1 text-xs text-slate-400">
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-violet-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>5 pages • 10 redirections</li>
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-violet-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Tous thèmes • Stats 365j</li>
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-violet-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Extensions modulables</li>
                    </ul>
                    <a href="/premium/configure"
                        class="block w-full py-2.5 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-semibold text-center text-sm shadow-lg shadow-violet-900/30 hover:shadow-violet-900/50 hover:-translate-y-0.5 transition-all active:scale-[0.97]">
                        Configurer
                    </a>
                </div>

                <!-- Yearly -->
                <div
                    class="rounded-2xl border border-emerald-500/20 bg-gradient-to-b from-emerald-500/[0.04] to-transparent p-6 flex flex-col relative">
                    <div class="absolute -top-2.5 left-1/2 -translate-x-1/2"><span
                            class="px-3 py-0.5 rounded-full bg-emerald-500 text-white text-[9px] font-bold uppercase tracking-wider">−17%</span>
                    </div>
                    <div class="flex items-center gap-2.5 mb-4">
                        <div class="w-8 h-8 rounded-lg bg-emerald-500/15 grid place-items-center"><svg
                                class="w-4 h-4 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                            </svg></div>
                        <h3 class="font-semibold text-white">Annuel</h3>
                    </div>
                    <div class="flex items-baseline gap-1 mb-1">
                        <span class="text-2xl font-extrabold text-white">49,90€</span>
                        <span class="text-xs text-slate-500">/an</span>
                    </div>
                    <p class="text-[10px] text-emerald-400 font-medium mb-5">≈ 4,16€/mois</p>
                    <ul class="space-y-2 mb-6 flex-1 text-xs text-slate-400">
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-emerald-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Tout Mensuel + extensions</li>
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-emerald-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>2 mois offerts</li>
                    </ul>
                    <a href="/premium/configure"
                        class="block w-full py-2.5 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white font-semibold text-center text-sm transition-all active:scale-[0.97]">
                        Configurer
                    </a>
                </div>

                <!-- Lifetime -->
                <div
                    class="rounded-2xl border border-amber-500/20 bg-gradient-to-b from-amber-500/[0.04] to-transparent p-6 flex flex-col relative">
                    <div class="absolute -top-2.5 left-1/2 -translate-x-1/2"><span
                            class="px-3 py-0.5 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 text-white text-[9px] font-bold uppercase tracking-wider">À
                            vie</span></div>
                    <div class="flex items-center gap-2.5 mb-4">
                        <div class="w-8 h-8 rounded-lg bg-amber-500/15 grid place-items-center"><svg
                                class="w-4 h-4 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
                            </svg></div>
                        <h3 class="font-semibold text-white">Lifetime</h3>
                    </div>
                    <div class="flex items-baseline gap-1 mb-1">
                        <span class="text-2xl font-extrabold text-white">75€</span>
                        <span class="text-xs text-slate-500">une fois</span>
                    </div>
                    <p class="text-[10px] text-amber-400 font-medium mb-5">Paiement unique</p>
                    <ul class="space-y-2 mb-6 flex-1 text-xs text-slate-400">
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-amber-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Tout inclus à vie</li>
                        <li class="flex items-center gap-2"><svg class="w-3.5 h-3.5 text-amber-400 flex-shrink-0"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>Futures fonctionnalités</li>
                    </ul>
                    <a href="/premium/configure"
                        class="block w-full py-2.5 rounded-xl bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-semibold text-center text-sm transition-all active:scale-[0.97]">
                        Configurer
                    </a>
                </div>
            </div>

            <% } else if (isConfig) { %>
                <!-- ═══════════════════ DASHBOARD CONFIG ═══════════════════ -->
                <div class="max-w-5xl mx-auto">

                    <!-- Header -->
                    <div class="text-center mb-10">
                        <div
                            class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-violet-500/10 border border-violet-500/20 text-violet-400 text-xs font-semibold uppercase tracking-widest mb-4">
                            <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M12 2L9.19 8.62 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2z" />
                            </svg>
                            Configurer Premium
                        </div>
                        <h2 class="text-2xl md:text-3xl font-extrabold text-white mb-2">Choisissez votre formule</h2>
                        <p class="text-slate-400 text-sm">Sélectionnez un plan puis personnalisez avec des extensions
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                        <!-- LEFT: Plan Selection (2 cols) -->
                        <div class="lg:col-span-2 space-y-6">

                            <!-- Step 1: Plan Selection -->
                            <div>
                                <div class="flex items-center gap-3 mb-4">
                                    <div
                                        class="w-7 h-7 rounded-full bg-violet-500/20 text-violet-400 grid place-items-center text-xs font-bold">
                                        1</div>
                                    <h3 class="text-sm font-bold text-white uppercase tracking-wider">Choisissez votre
                                        formule</h3>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <!-- Monthly -->
                                    <button type="button" onclick="selectPlan('monthly')" id="plan_monthly"
                                        class="plan-btn relative rounded-2xl border-2 border-violet-500/50 bg-violet-500/5 p-5 transition-all hover:bg-violet-500/10 text-left group">
                                        <div class="absolute -top-2.5 left-1/2 -translate-x-1/2">
                                            <span
                                                class="px-3 py-0.5 rounded-full bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white text-[9px] font-bold uppercase tracking-wider shadow-lg">Populaire</span>
                                        </div>
                                        <div class="flex items-center gap-2 mb-3">
                                            <div class="w-8 h-8 rounded-lg bg-violet-500/20 grid place-items-center">
                                                <svg class="w-4 h-4 text-violet-400" fill="none" viewBox="0 0 24 24"
                                                    stroke="currentColor" stroke-width="1.5">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                                                </svg>
                                            </div>
                                            <span class="text-sm font-bold text-white">Mensuel</span>
                                        </div>
                                        <div class="flex items-baseline gap-1 mb-2">
                                            <span class="text-2xl font-extrabold text-violet-400">4.99€</span>
                                            <span class="text-xs text-slate-500">/mois</span>
                                        </div>
                                        <p class="text-[11px] text-slate-500">Sans engagement</p>
                                        <ul class="mt-3 pt-3 border-t border-white/5 space-y-1.5">
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-violet-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>5 pages</li>
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-violet-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>10 redirections</li>
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-violet-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>+ Extensions</li>
                                        </ul>
                                    </button>

                                    <!-- Yearly -->
                                    <button type="button" onclick="selectPlan('yearly')" id="plan_yearly"
                                        class="plan-btn relative rounded-2xl border-2 border-slate-700 bg-slate-800/30 p-5 transition-all hover:bg-slate-800/50 text-left group">
                                        <div class="absolute -top-2.5 left-1/2 -translate-x-1/2">
                                            <span
                                                class="px-3 py-0.5 rounded-full bg-emerald-500 text-white text-[9px] font-bold uppercase tracking-wider shadow-lg">−17%</span>
                                        </div>
                                        <div class="flex items-center gap-2 mb-3">
                                            <div class="w-8 h-8 rounded-lg bg-emerald-500/20 grid place-items-center">
                                                <svg class="w-4 h-4 text-emerald-400" fill="none" viewBox="0 0 24 24"
                                                    stroke="currentColor" stroke-width="1.5">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                                                </svg>
                                            </div>
                                            <span class="text-sm font-bold text-white">Annuel</span>
                                        </div>
                                        <div class="flex items-baseline gap-1 mb-1">
                                            <span class="text-2xl font-extrabold text-emerald-400">49.90€</span>
                                            <span class="text-xs text-slate-500">/an</span>
                                        </div>
                                        <p class="text-[11px] text-emerald-400/70">≈ 4,16€/mois</p>
                                        <ul class="mt-3 pt-3 border-t border-white/5 space-y-1.5">
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-emerald-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>Tout Mensuel</li>
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-emerald-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>Extensions incluses</li>
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-emerald-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>2 mois offerts</li>
                                        </ul>
                                    </button>

                                    <!-- Lifetime -->
                                    <button type="button" onclick="selectPlan('lifetime')" id="plan_lifetime"
                                        class="plan-btn relative rounded-2xl border-2 border-slate-700 bg-slate-800/30 p-5 transition-all hover:bg-slate-800/50 text-left group">
                                        <div class="absolute -top-2.5 left-1/2 -translate-x-1/2">
                                            <span
                                                class="px-3 py-0.5 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 text-white text-[9px] font-bold uppercase tracking-wider shadow-lg">À
                                                vie</span>
                                        </div>
                                        <div class="flex items-center gap-2 mb-3">
                                            <div class="w-8 h-8 rounded-lg bg-amber-500/20 grid place-items-center">
                                                <svg class="w-4 h-4 text-amber-400" fill="none" viewBox="0 0 24 24"
                                                    stroke="currentColor" stroke-width="1.5">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
                                                </svg>
                                            </div>
                                            <span class="text-sm font-bold text-white">Lifetime</span>
                                        </div>
                                        <div class="flex items-baseline gap-1 mb-1">
                                            <span class="text-2xl font-extrabold text-amber-400">75€</span>
                                            <span class="text-xs text-slate-500">une fois</span>
                                        </div>
                                        <p class="text-[11px] text-amber-400/70">Paiement unique</p>
                                        <ul class="mt-3 pt-3 border-t border-white/5 space-y-1.5">
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-amber-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>Tout inclus à vie</li>
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-amber-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>Futures features</li>
                                            <li class="flex items-center gap-1.5 text-[11px] text-slate-400"><svg
                                                    class="w-3 h-3 text-amber-400 flex-shrink-0" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M5 13l4 4L19 7" />
                                                </svg>Aucun renouvellement</li>
                                        </ul>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 2: Extensions (only for monthly) -->
                            <div id="extensions_section" class="transition-all duration-300">
                                <div class="flex items-center gap-3 mb-4">
                                    <div
                                        class="w-7 h-7 rounded-full bg-indigo-500/20 text-indigo-400 grid place-items-center text-xs font-bold">
                                        2</div>
                                    <h3 class="text-sm font-bold text-white uppercase tracking-wider">Personnalisez</h3>
                                    <span
                                        class="text-[10px] text-slate-500 bg-slate-800 px-2 py-0.5 rounded-full">Mensuel
                                        uniquement</span>
                                </div>

                                <div class="space-y-3">
                                    <!-- Plinkks -->
                                    <div class="rounded-xl bg-slate-900/60 border border-slate-800 p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div
                                                    class="w-8 h-8 rounded-lg bg-indigo-500/15 text-indigo-400 grid place-items-center">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke-width="2"
                                                            stroke-linecap="round" />
                                                    </svg>
                                                </div>
                                                <div>
                                                    <span class="block text-sm font-medium text-white">Pages
                                                        supplémentaires</span>
                                                    <span class="block text-[11px] text-slate-500">1.00€ / page /
                                                        mois</span>
                                                </div>
                                            </div>
                                            <span class="font-bold text-sm text-indigo-400"
                                                id="price_plinkk">0.00€</span>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <button onclick="changeVal('input_plinkk', -1)"
                                                class="w-9 h-9 rounded-lg bg-slate-800 hover:bg-slate-700 text-white font-bold transition-colors grid place-items-center border border-slate-700">−</button>
                                            <input type="number" id="input_plinkk" value="0" min="0" max="50"
                                                class="bg-slate-800/50 border border-slate-700 rounded-lg text-center text-white font-bold w-16 py-2 text-sm"
                                                readonly>
                                            <button onclick="changeVal('input_plinkk', 1)"
                                                class="w-9 h-9 rounded-lg bg-slate-800 hover:bg-slate-700 text-white font-bold transition-colors grid place-items-center border border-slate-700">+</button>
                                        </div>
                                    </div>

                                    <!-- Redirects -->
                                    <div class="rounded-xl bg-slate-900/60 border border-slate-800 p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div
                                                    class="w-8 h-8 rounded-lg bg-emerald-500/15 text-emerald-400 grid place-items-center">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path d="M13 7l5 5m0 0l-5 5m5-5H6" stroke-width="2"
                                                            stroke-linecap="round" stroke-linejoin="round" />
                                                    </svg>
                                                </div>
                                                <div>
                                                    <span class="block text-sm font-medium text-white">Packs de 5
                                                        Redirections</span>
                                                    <span class="block text-[11px] text-slate-500">1.00€ / pack /
                                                        mois</span>
                                                </div>
                                            </div>
                                            <span class="font-bold text-sm text-emerald-400"
                                                id="price_redirect">0.00€</span>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <button onclick="changeVal('input_redirect', -1)"
                                                class="w-9 h-9 rounded-lg bg-slate-800 hover:bg-slate-700 text-white font-bold transition-colors grid place-items-center border border-slate-700">−</button>
                                            <input type="number" id="input_redirect" value="0" min="0" max="50"
                                                class="bg-slate-800/50 border border-slate-700 rounded-lg text-center text-white font-bold w-16 py-2 text-sm"
                                                readonly>
                                            <button onclick="changeVal('input_redirect', 1)"
                                                class="w-9 h-9 rounded-lg bg-slate-800 hover:bg-slate-700 text-white font-bold transition-colors grid place-items-center border border-slate-700">+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- RIGHT: Sticky Summary Panel -->
                        <div class="lg:col-span-1">
                            <div
                                class="lg:sticky lg:top-24 rounded-2xl bg-gradient-to-b from-slate-900 to-slate-950 border border-slate-800 overflow-hidden">
                                <!-- Gradient top bar -->
                                <div class="h-1 bg-gradient-to-r from-violet-600 via-fuchsia-600 to-violet-600"></div>

                                <div class="p-6">
                                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-5">
                                        Récapitulatif</h3>

                                    <!-- Price breakdown -->
                                    <div class="space-y-3 mb-6 pb-6 border-b border-slate-800">
                                        <div class="flex justify-between text-sm">
                                            <span class="text-slate-400">Formule</span>
                                            <span class="text-white font-medium" id="summary_plan">Mensuel</span>
                                        </div>
                                        <div class="flex justify-between text-sm" id="summary_ext_row">
                                            <span class="text-slate-400">Extensions</span>
                                            <span class="text-white font-medium" id="summary_ext">0.00€</span>
                                        </div>
                                    </div>

                                    <!-- Total -->
                                    <div class="text-center mb-6">
                                        <span class="block text-xs text-slate-500 uppercase tracking-wider mb-1"
                                            id="total_label">Total mensuel estimé</span>
                                        <div class="flex items-baseline justify-center gap-1">
                                            <span class="text-4xl font-extrabold text-white"
                                                id="total_price">4.99€</span>
                                            <span class="text-sm text-slate-500" id="total_suffix">/mois</span>
                                        </div>
                                    </div>

                                    <!-- CTA -->
                                    <button onclick="updateSubscription()" id="btn_update"
                                        class="w-full py-3.5 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white font-bold shadow-lg shadow-violet-900/40 transition-all active:scale-[0.97] text-sm">
                                        Mettre à jour mon abonnement
                                    </button>

                                    <p class="text-[10px] text-slate-600 text-center mt-3 leading-relaxed">
                                        Le montant sera ajusté au prorata. En cliquant, vous acceptez nos <a href="/cgv"
                                            class="text-slate-400 hover:text-white transition-colors">CGV</a>.
                                    </p>

                                    <!-- Trust badges -->
                                    <div
                                        class="flex items-center justify-center gap-4 mt-5 pt-5 border-t border-slate-800/50">
                                        <div class="flex items-center gap-1.5 text-[10px] text-slate-500">
                                            <svg class="w-3.5 h-3.5 text-emerald-400" fill="none" viewBox="0 0 24 24"
                                                stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                                            </svg>
                                            Paiement sécurisé
                                        </div>
                                        <div class="flex items-center gap-1.5 text-[10px] text-slate-500">
                                            <svg class="w-3.5 h-3.5 text-violet-400" fill="none" viewBox="0 0 24 24"
                                                stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
                                            </svg>
                                            Résiliation libre
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <script>
                    const PLAN_PRICES = { monthly: 4.99, yearly: 49.90, lifetime: 75.00 };
                    const PLAN_LABELS = { monthly: 'Mensuel', yearly: 'Annuel', lifetime: 'Lifetime' };
                    const EXT_PRICES = { plinkk: 1.00, redirect: 1.00 };
                    let selectedPlan = 'monthly';

                    function selectPlan(plan) {
                        selectedPlan = plan;
                        document.querySelectorAll('.plan-btn').forEach(function (btn) {
                            btn.classList.remove('border-violet-500/50', 'bg-violet-500/5', 'border-emerald-500/50', 'bg-emerald-500/5', 'border-amber-500/50', 'bg-amber-500/5');
                            btn.classList.add('border-slate-700', 'bg-slate-800/30');
                        });
                        var el = document.getElementById('plan_' + plan);
                        el.classList.remove('border-slate-700', 'bg-slate-800/30');
                        if (plan === 'monthly') { el.classList.add('border-violet-500/50', 'bg-violet-500/5'); }
                        else if (plan === 'yearly') { el.classList.add('border-emerald-500/50', 'bg-emerald-500/5'); }
                        else { el.classList.add('border-amber-500/50', 'bg-amber-500/5'); }

                        var extSection = document.getElementById('extensions_section');
                        if (plan === 'lifetime' || plan === 'yearly') {
                            extSection.style.opacity = '0.3';
                            extSection.style.pointerEvents = 'none';
                        } else {
                            extSection.style.opacity = '1';
                            extSection.style.pointerEvents = 'auto';
                        }
                        updateTotal();
                    }

                    function changeVal(id, delta) {
                        var el = document.getElementById(id);
                        var val = parseInt(el.value) || 0;
                        val = Math.max(0, Math.min(50, val + delta));
                        el.value = val;
                        updateTotal();
                    }

                    function updateTotal() {
                        var nbPlinkk = parseInt(document.getElementById('input_plinkk').value) || 0;
                        var nbRedirect = parseInt(document.getElementById('input_redirect').value) || 0;

                        var baseCost = PLAN_PRICES[selectedPlan];
                        var extCost = (selectedPlan === 'lifetime' || selectedPlan === 'yearly') ? 0 : (nbPlinkk * EXT_PRICES.plinkk) + (nbRedirect * EXT_PRICES.redirect);
                        var total = baseCost + extCost;

                        document.getElementById('total_price').innerText = total.toFixed(2) + '€';
                        document.getElementById('price_plinkk').innerText = (nbPlinkk * EXT_PRICES.plinkk).toFixed(2) + '€';
                        document.getElementById('price_redirect').innerText = (nbRedirect * EXT_PRICES.redirect).toFixed(2) + '€';

                        // Summary panel
                        var summaryPlan = document.getElementById('summary_plan');
                        var summaryExt = document.getElementById('summary_ext');
                        var summaryExtRow = document.getElementById('summary_ext_row');
                        if (summaryPlan) summaryPlan.innerText = PLAN_LABELS[selectedPlan] + ' — ' + baseCost.toFixed(2) + '€';
                        if (summaryExt) summaryExt.innerText = extCost.toFixed(2) + '€';
                        if (summaryExtRow) summaryExtRow.style.display = (selectedPlan === 'lifetime' || selectedPlan === 'yearly') ? 'none' : 'flex';

                        var suffix = document.getElementById('total_suffix');
                        var label = document.getElementById('total_label');
                        if (selectedPlan === 'monthly') {
                            suffix.innerText = '/mois';
                            label.innerText = 'Total mensuel estimé';
                        } else if (selectedPlan === 'yearly') {
                            suffix.innerText = '/an';
                            label.innerText = 'Total annuel estimé';
                        } else {
                            suffix.innerText = ' (paiement unique)';
                            label.innerText = 'Total lifetime';
                        }
                    }

                    async function updateSubscription() {
                        var btn = document.getElementById('btn_update');
                        var originalText = btn.innerText;
                        btn.innerText = "Traitement...";
                        btn.disabled = true;

                        var payload = {
                            plan: selectedPlan,
                            premium: true,
                            extraPlinkks: (selectedPlan === 'lifetime' || selectedPlan === 'yearly') ? 0 : (parseInt(document.getElementById('input_plinkk').value) || 0),
                            extraRedirects: (selectedPlan === 'lifetime' || selectedPlan === 'yearly') ? 0 : (parseInt(document.getElementById('input_redirect').value) || 0)
                        };

                        try {
                            var res = await fetch('/api/stripe/update-plan', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });
                            var data = await res.json();

                            if (data.url) {
                                window.location.href = data.url;
                            } else if (data.updated) {
                                alert(data.message || "Abonnement mis à jour !");
                                window.location.href = '/premium';
                            } else {
                                alert("Erreur: " + (data.error || "Inconnue"));
                                btn.innerText = originalText;
                                btn.disabled = false;
                            }
                        } catch (e) {
                            alert("Erreur de connexion");
                            console.error(e);
                            btn.innerText = originalText;
                            btn.disabled = false;
                        }
                    }

                    updateTotal();
                </script>
                <% } %>