<%- include('../partials/head.ejs', { title: 'Admin - Prévisualisation thème', description: '', robots: 'noindex,nofollow' }) %>
<%- include('../partials/header-dash.ejs') %>

<main class="max-w-5xl mx-auto p-4 space-y-5">
  <div class="flex items-start justify-between">
    <div>
      <h1 class="text-2xl font-semibold"><%= theme.name %></h1>
      <p class="text-sm text-slate-400">par @<%= theme.author.userName %></p>
    </div>
    <div class="flex gap-2">
      <button id="approveBtn" class="px-3 py-2 rounded bg-emerald-600 text-white text-sm">Approuver</button>
      <button id="rejectBtn" class="px-3 py-2 rounded bg-rose-600 text-white text-sm">Rejeter</button>
    </div>
  </div>

  <div id="previewBox" class="rounded p-4 border border-slate-800">
    <div class="flex gap-2">
      <button id="btnPrimary" class="px-3 py-2 text-sm rounded">Bouton</button>
      <button id="btnHover" class="px-3 py-2 text-sm rounded">Hover</button>
    </div>
    <p class="mt-3 text-sm">Texte d'exemple</p>
  </div>
</main>

<script>
(function(){
  const d = JSON.parse(String.raw`<%- JSON.stringify(JSON.stringify(theme.data)) %>`);
  const id = '<%= theme.id %>';
  const previewBox = document.getElementById('previewBox');
  const btnPrimary = document.getElementById('btnPrimary');
  const btnHover = document.getElementById('btnHover');
  function applyPreview(){
    previewBox.style.background = d.background || '#111827';
    previewBox.style.color = d.textColor || '#e5e7eb';
    btnPrimary.style.background = d.buttonBackground || '#4f46e5'; btnPrimary.style.color = d.buttonTextColor || '#111827';
    btnHover.style.background = d.hoverColor || '#22c55e'; btnHover.style.color = d.textColor || '#e5e7eb';
  }
  applyPreview();
  document.getElementById('approveBtn').addEventListener('click', async ()=>{
    const res = await fetch('/api/themes/'+encodeURIComponent(id)+'/approve', { method: 'POST' });
    if (!res.ok) { alert('Erreur'); return; }
    alert('Approuvé'); window.location.href = '/dashboard/admin/themes';
  });
  document.getElementById('rejectBtn').addEventListener('click', async ()=>{
    const res = await fetch('/api/themes/'+encodeURIComponent(id)+'/reject', { method: 'POST' });
    if (!res.ok) { alert('Erreur'); return; }
    alert('Rejeté'); window.location.href = '/dashboard/admin/themes';
  });
})();
</script>
